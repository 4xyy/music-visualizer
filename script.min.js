const audioElement=document.getElementById("audioElement"),fileInput=document.getElementById("audioUpload"),canvas=document.getElementById("visualizer"),canvasContext=canvas.getContext("2d");canvas.width=.8*window.innerWidth,canvas.height=.7*window.innerHeight;const audioContext=new(window.AudioContext||window.webkitAudioContext),analyser=audioContext.createAnalyser();analyser.fftSize=256;const bufferLength=analyser.frequencyBinCount,dataArray=new Uint8Array(bufferLength),visualizerModes=[{name:"Spectrum",draw:drawSpectrum},{name:"Fireworks",draw:drawFireworks},{name:"Oscilloscope",draw:drawOscilloscope},{name:"Particle Explosion",draw:drawParticleExplosion},{name:"Circular Bars",draw:drawCircularBars},{name:"Waveform Tunnel",draw:drawWaveformTunnel},{name:"Starfield",draw:drawStarfield},{name:"Rings",draw:drawRings},{name:"Squares",draw:drawSquares},{name:"Triangles",draw:drawTriangles},{name:"Hexagons",draw:drawHexagons},{name:"Galaxy",draw:drawGalaxy},{name:"Spiral",draw:drawSpiral},{name:"Waveform Pulse",draw:drawWaveformPulse},{name:"Pulsating Circles",draw:drawPulsatingCircles},{name:"Random Dots",draw:drawRandomDots},{name:"Ripple",draw:drawRipple},{name:"Flame",draw:drawFlame},{name:"Electric Pulse",draw:drawElectricPulse},{name:"Fireflies",draw:drawFireflies}];let currentVisualizer=visualizerModes[0].draw;const buttonContainer=document.getElementById("visualizerButtons");function drawVisualizer(){requestAnimationFrame(drawVisualizer),analyser.getByteFrequencyData(dataArray),canvasContext.clearRect(0,0,canvas.width,canvas.height),currentVisualizer()}visualizerModes.forEach(((a,t)=>{const e=document.createElement("button");e.innerHTML=a.name,e.onclick=()=>{currentVisualizer=a.draw},buttonContainer.appendChild(e)})),fileInput.onchange=function(){const a=fileInput.files;if(a.length>0){const t=URL.createObjectURL(a[0]);audioElement.src=t,audioElement.play(),audioElement.onplay=()=>{"suspended"===audioContext.state&&audioContext.resume();audioContext.createMediaElementSource(audioElement).connect(analyser),analyser.connect(audioContext.destination),drawVisualizer()}}};const colorPicker=document.getElementById("colorPicker"),barWidthSlider=document.getElementById("barWidth"),particleSizeSlider=document.getElementById("particleSize"),explosionColorPicker=document.getElementById("explosionColor");let barColor=colorPicker.value,barWidth=parseInt(barWidthSlider.value),particleSize=parseInt(particleSizeSlider.value),explosionColor=explosionColorPicker.value;function drawSpectrum(){let a=0;for(let t=0;t<bufferLength;t++){let e=dataArray[t]/2;canvasContext.fillStyle=barColor,canvasContext.fillRect(a,canvas.height-e/2,barWidth,e/2),a+=barWidth+1}}function drawFireworks(){for(let a=0;a<bufferLength;a++){let t=dataArray[a]/5+particleSize,e=Math.random()*canvas.width,n=Math.random()*canvas.height;canvasContext.beginPath(),canvasContext.arc(e,n,t,0,2*Math.PI),canvasContext.fillStyle=explosionColor,canvasContext.fill()}}function drawOscilloscope(){canvasContext.beginPath();let a=canvas.width/bufferLength,t=0;for(let e=0;e<bufferLength;e++){const n=dataArray[e]/128*canvas.height/2;0===e?canvasContext.moveTo(t,n):canvasContext.lineTo(t,n),t+=a}canvasContext.lineTo(canvas.width,canvas.height/2),canvasContext.strokeStyle=barColor,canvasContext.stroke()}function drawParticleExplosion(){for(let a=0;a<bufferLength;a++){let t=dataArray[a]/5+particleSize,e=canvas.width/2,n=canvas.height/2;canvasContext.beginPath(),canvasContext.arc(e+200*Math.random()-100,n+200*Math.random()-100,t,0,2*Math.PI),canvasContext.fillStyle=explosionColor,canvasContext.fill()}}function drawCircularBars(){let a=canvas.width/2,t=canvas.height/2,e=Math.min(canvas.width,canvas.height)/3,n=2*Math.PI/bufferLength;for(let r=0;r<bufferLength;r++){let o=dataArray[r]/2,i=r*n,l=a+Math.cos(i)*e,s=t+Math.sin(i)*e,c=a+Math.cos(i)*(e+o),d=t+Math.sin(i)*(e+o);canvasContext.strokeStyle=`rgb(${o+100}, 50, ${255-o})`,canvasContext.beginPath(),canvasContext.moveTo(l,s),canvasContext.lineTo(c,d),canvasContext.stroke()}}function drawWaveformTunnel(){let a=canvas.width/2,t=canvas.height/2;for(let e=0;e<bufferLength;e++){let n=dataArray[e]/2;canvasContext.beginPath(),canvasContext.arc(a,t,n+10*e,0,2*Math.PI),canvasContext.strokeStyle=`rgb(${255-n}, ${100+n}, 150)`,canvasContext.stroke()}}function drawStarfield(){for(let a=0;a<bufferLength;a++){let t=Math.random()*canvas.width,e=Math.random()*canvas.height,n=dataArray[a]/5;canvasContext.fillStyle=`rgba(${n+100}, 255, ${255-n}, 0.8)`,canvasContext.beginPath(),canvasContext.arc(t,e,n,0,2*Math.PI),canvasContext.fill()}}function drawRings(){let a=canvas.width/2,t=canvas.height/2;for(let e=0;e<bufferLength;e++){let n=dataArray[e]/2+10*e;canvasContext.beginPath(),canvasContext.arc(a,t,n,0,2*Math.PI),canvasContext.strokeStyle=`rgb(${n+50}, ${200-n}, 255)`,canvasContext.stroke()}}function drawSquares(){for(let a=0;a<bufferLength;a++){let t=dataArray[a]/2,e=Math.random()*canvas.width,n=Math.random()*canvas.height;canvasContext.fillStyle=`rgb(${t+100}, 100, ${255-t})`,canvasContext.fillRect(e,n,t,t)}}function drawTriangles(){for(let a=0;a<bufferLength;a++){let t=dataArray[a]/2,e=Math.random()*canvas.width,n=Math.random()*canvas.height;canvasContext.beginPath(),canvasContext.moveTo(e,n),canvasContext.lineTo(e+t,n+t),canvasContext.lineTo(e-t,n+t),canvasContext.closePath(),canvasContext.fillStyle=`rgb(100, ${t+150}, ${255-t})`,canvasContext.fill()}}function drawHexagons(){for(let a=0;a<bufferLength;a++){let t=dataArray[a]/4,e=Math.random()*canvas.width,n=Math.random()*canvas.height;canvasContext.beginPath();for(let a=0;a<6;a++)canvasContext.lineTo(e+t*Math.cos(a*Math.PI/3),n+t*Math.sin(a*Math.PI/3));canvasContext.closePath(),canvasContext.strokeStyle=`rgb(${t+50}, ${255-t}, 150)`,canvasContext.stroke()}}function drawGalaxy(){let a=canvas.width/2,t=canvas.height/2;for(let e=0;e<bufferLength;e++){let n=e*(Math.PI/64),r=dataArray[e]/2,o=a+Math.cos(n)*r,i=t+Math.sin(n)*r,l=dataArray[e]/10;canvasContext.fillStyle=`rgba(200, ${150+l}, 255, 0.8)`,canvasContext.beginPath(),canvasContext.arc(o,i,l,0,2*Math.PI),canvasContext.fill()}}function drawSpiral(){let a=canvas.width/2,t=canvas.height/2,e=Math.PI/16;canvasContext.beginPath();for(let n=0;n<bufferLength;n++){let r=n*(dataArray[n]/10),o=n*e,i=a+Math.cos(o)*r,l=t+Math.sin(o)*r;canvasContext.fillStyle=`rgb(${255-r}, ${r+100}, 200)`,canvasContext.arc(i,l,3,0,2*Math.PI),canvasContext.fill()}canvasContext.closePath()}function drawWaveformPulse(){let a=canvas.width/2,t=canvas.height/2;for(let e=0;e<bufferLength;e++){let n=dataArray[e]/3;canvasContext.beginPath(),canvasContext.arc(a,t,n,0,2*Math.PI),canvasContext.strokeStyle=`rgba(${255-n}, 50, ${n+50}, 0.7)`,canvasContext.stroke()}}function drawPulsatingCircles(){let a=canvas.width/2,t=canvas.height/2;for(let e=0;e<bufferLength;e++){let n=dataArray[e]/5+2*e;canvasContext.beginPath(),canvasContext.arc(a,t,n,0,2*Math.PI),canvasContext.strokeStyle=`rgba(${n+50}, 100, ${255-n}, 0.8)`,canvasContext.stroke()}}function drawRandomDots(){for(let a=0;a<bufferLength;a++){let t=Math.random()*canvas.width,e=Math.random()*canvas.height,n=dataArray[a]/4;canvasContext.fillStyle=`rgba(${100+n}, ${255-n}, 255, 0.8)`,canvasContext.beginPath(),canvasContext.arc(t,e,n,0,2*Math.PI),canvasContext.fill()}}function drawRipple(){let a=canvas.width/2,t=canvas.height/2;for(let e=0;e<bufferLength;e++){let n=dataArray[e]/5+5*e;canvasContext.beginPath(),canvasContext.arc(a,t,n,0,2*Math.PI),canvasContext.strokeStyle=`rgba(100, ${n+100}, 255, 0.7)`,canvasContext.stroke()}}function drawFlame(){for(let a=0;a<bufferLength;a++){let t=dataArray[a]/2,e=Math.random()*canvas.width,n=canvas.height;canvasContext.fillStyle=`rgba(${255-t}, ${t+50}, 50, 0.9)`,canvasContext.fillRect(e,n-t,5,t)}}function drawElectricPulse(){let a=canvas.width/2,t=canvas.height/2;for(let e=0;e<bufferLength;e++){let n=dataArray[e]/2+2*e,r=a+Math.cos(e)*n,o=t+Math.sin(e)*n;canvasContext.strokeStyle=`rgba(255, ${100+n}, ${255-n}, 0.8)`,canvasContext.beginPath(),canvasContext.moveTo(a,t),canvasContext.lineTo(r,o),canvasContext.stroke()}}function drawFireflies(){for(let a=0;a<bufferLength;a++){let t=Math.random()*canvas.width,e=Math.random()*canvas.height,n=dataArray[a]/6;canvasContext.fillStyle=`rgba(255, 255, ${n+150}, 0.8)`,canvasContext.beginPath(),canvasContext.arc(t,e,n,0,2*Math.PI),canvasContext.fill()}}colorPicker.addEventListener("input",(function(){barColor=this.value})),barWidthSlider.addEventListener("input",(function(){barWidth=parseInt(this.value)})),particleSizeSlider.addEventListener("input",(function(){particleSize=parseInt(this.value)})),explosionColorPicker.addEventListener("input",(function(){explosionColor=this.value}));